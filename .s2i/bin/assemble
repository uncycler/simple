#!/bin/bash -e
#
# S2I assemble script for the 's2i-nginx' image.
# The 'assemble' script builds your application source ready to run.
#
# For more information refer to the documentation:
#	https://github.com/openshift/source-to-image/blob/master/docs/builder_image.md
#
echo "caca"

if [ "$1" = "-h" ]; then
	# If the 's2i-nginx' assemble script is executed with '-h' flag,
	# print the usage.
	exec ${S2I_SCRIPTS_PATH}/usage
fi

NGINX_STATIC_DIR=${NGINX_STATIC_DIR-html}
NGINX_CONF_FILE=${NGINX_CONF_FILE-}
NGINX_CONF_DIR=${NGINX_CONF_DIR-conf.d}
NGINX_AUX_DIR=${NGINX_AUX_DIR-aux}

copy_server_configs() {
    echo "---> Copying nginx config to location"
		cp /tmp/src/etc/default.conf /etc/nginx/conf.d/default.conf
}

test_config() {
    echo "---> testing config"
    if ! $NGINX_BASE_DIR/usr/sbin/nginx -c /etc/nginx/nginx.conf -t ; then
        echo "nginx configuration not valid."
        echo
        for f in /etc/nginx/conf.d/*; do
            echo "==> $f <=="
            cat $f
        done
        exit 1
    fi
}

ls /tmp/src
copy_server_configs

test_config
